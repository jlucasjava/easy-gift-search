const API_URL="localhost"===window.location.hostname?"http://localhost:3000/api":"https://easy-gift-search.onrender.com/api";function showLoader(e){document.getElementById("loader").style.display=e?"block":"none"}function showMensagem(e,n=!1){const t=document.getElementById("mensagem");t.textContent=e,t.style.display=e?"block":"none",t.style.color=n?"#d32f2f":"#4e54c8"}function clearMensagem(){showMensagem("")}function mostrarSecao(e){["produtos","favoritos","locais"].forEach((e=>{const n=document.getElementById(e);n&&(n.style.display="none")}));const n=document.getElementById(e);n&&(n.style.display="");document.querySelectorAll(".tab-btn").forEach((e=>e.classList.remove("active")));const t=document.getElementById({produtos:"btnVerResultados",favoritos:"btnVerFavoritos",locais:"btnVerLocais"}[e]);t&&t.classList.add("active")}async function buscarProdutos(e={}){if(showLoader(!0),clearMensagem(),window.analyticsService){const n=e.query||"busca_geral",t={max_price:e.precoMax||null,age:e.idade||null,gender:e.genero||null,page:e.page||1};window.analyticsService.trackSearch(n,t),e.precoMax&&window.analyticsService.trackFilterUsage("price_max",e.precoMax),e.idade&&window.analyticsService.trackFilterUsage("age",e.idade),e.genero&&window.analyticsService.trackFilterUsage("gender",e.genero)}try{const n=new URLSearchParams(e).toString(),t=await fetch(`${API_URL}/products?${n}`);if(!t.ok)throw new Error("Erro ao buscar produtos.");return await t.json()}catch(e){return window.analyticsService&&window.analyticsService.trackError("API_Error",e.message,"buscarProdutos"),showMensagem("Erro ao buscar produtos. Tente novamente.",!0),{produtos:[],pagina:1,totalPaginas:1}}finally{showLoader(!1)}}function renderGrid(e){const n=document.getElementById("grid");n.innerHTML="";const o=(e||[]).filter((e=>e.url&&/^https?:\/\//.test(e.url)));o.length?(clearMensagem(),o.forEach(((e,o)=>{const a=document.createElement("div");a.className="card";const r=e.nome||e.titulo||"Produto sem nome",i=e.preco||"Consulte",s=e.imagem||"/images/placeholder.jpg",c=e.url||"#",d=e.id||Math.random().toString(36).substr(2,9),l=e.marketplace||"marketplace",m=r.replace(/'/g,"\\'");a.innerHTML=`\n      <img src="${s}" alt="${r}" loading="lazy" onerror="this.onerror=null;this.src='/images/placeholder.jpg';">\n      <h3>${r}</h3>\n      <p>R$ ${i}</p>\n      <a href="${c}" target="_blank" onclick="trackProductClick('${d}', '${m}', '${i}', '${l}', ${o}, '${c}')">${t("ver_marketplace")}</a>\n      <button onclick="favoritarProduto('${d}', '${m}')">${t("favoritar")}</button>\n    `,window.analyticsService&&window.analyticsService.trackProductView(e.id,e.nome,e.preco,e.marketplace),n.appendChild(a)}))):showMensagem(t("nenhum_produto"))}function getFavoritos(){return JSON.parse(localStorage.getItem("favoritos")||"[]")}function setFavoritos(e){localStorage.setItem("favoritos",JSON.stringify(e))}function renderFavoritos(){const e=getFavoritos(),n=document.getElementById("gridFavoritos");n.innerHTML="",e.length?e.forEach((e=>{const o=document.createElement("div");o.className="card",o.innerHTML=`\n      <img src="${e.imagem}" alt="${e.nome}" loading="lazy">\n      <h3>${e.nome}</h3>\n      <p>R$ ${e.preco}</p>\n      <a href="${e.url}" target="_blank">${t("ver_marketplace")}</a>\n      <button onclick="removerFavorito('${e.id}')">${t("remover")}</button>\n    `,n.appendChild(o)})):n.innerHTML=`<div style="grid-column:1/-1;text-align:center;color:#888;">${t("nenhum_favorito")}</div>`}function renderPaginacao(e,n,t){const o=document.getElementById("paginacao");o.innerHTML="";for(let a=1;a<=n;a++){const n=document.createElement("button");n.textContent=a,a===e&&(n.disabled=!0),n.onclick=()=>carregarProdutos({...t,page:a}),o.appendChild(n)}}async function carregarProdutos(e={}){showLoader(!0);try{const{produtos:n,pagina:t,totalPaginas:o}=await buscarProdutos(e);renderGrid(n),renderPaginacao(t,o,e)}finally{showLoader(!1)}}window.trackProductClick=function(e,n,t,o,a,r){window.analyticsService&&(window.analyticsService.trackProductClick(e,n,t,o,a),window.analyticsService.trackConversion(e,n,t,o,r))},window.favoritarProduto=function(e,n){const t=document.getElementById("grid"),o=Array.from(t.children).find((e=>e.querySelector("h3")?.textContent===n));if(!o)return;const a=o.querySelector("img")?.src,r=o.querySelector("p")?.textContent.replace("R$ ",""),i=o.querySelector("a")?.href,s=getFavoritos();if(s.some((n=>n.id===e)))return showMensagem(`Produto "${n}" j√° est√° nos favoritos!`),void setTimeout(clearMensagem,2e3);s.push({id:e,nome:n,preco:r,imagem:a,url:i}),setFavoritos(s),showMensagem(`Produto "${n}" adicionado aos favoritos!`),setTimeout(clearMensagem,2e3),renderFavoritos()},window.removerFavorito=function(e){let n=getFavoritos();n=n.filter((n=>n.id!==e)),setFavoritos(n),showMensagem("Produto removido dos favoritos!"),setTimeout(clearMensagem,2e3),renderFavoritos()};let currentLocais=[],currentMapaInfo=null;async function buscarLojasProximas(e,n="loja de presentes"){try{const t=new URLSearchParams({cidade:e,categoria:n,radius:"10000"}),o=await fetch(`${API_URL}/new-apis/maps/lojas?${t}`);if(!o.ok)throw new Error("Erro ao buscar lojas");const a=await o.json();a.sucesso&&a.dados&&(currentLocais=a.dados.lojas||[],currentMapaInfo=a.dados.info,renderLocais(),window.analyticsService&&window.analyticsService.trackEvent("location_search","api_call",e,{categoria:n,resultados:currentLocais.length}))}catch(e){console.error("Erro ao buscar lojas pr√≥ximas:",e),showMensagem("Erro ao buscar lojas pr√≥ximas.",!0)}}async function buscarShoppings(e,n){try{const t=new URLSearchParams({cidade:e,...n&&{estado:n}}),o=await fetch(`${API_URL}/new-apis/maps/shoppings?${t}`);if(!o.ok)throw new Error("Erro ao buscar shoppings");const a=await o.json();a.sucesso&&a.dados&&(currentLocais=a.dados.shoppings||[],currentMapaInfo=a.dados.info,renderLocais(),window.analyticsService&&window.analyticsService.trackEvent("shopping_search","api_call",e,{estado:n,resultados:currentLocais.length}))}catch(e){console.error("Erro ao buscar shoppings:",e),showMensagem("Erro ao buscar shopping centers.",!0)}}function renderLocais(){const e=document.getElementById("gridLocais"),n=document.getElementById("mapaInfo");currentMapaInfo&&(n.innerHTML=`\n      <strong>üìç ${currentMapaInfo.cidade||"Localiza√ß√£o"}</strong><br>\n      <small>Encontrados ${currentLocais.length} estabelecimentos pr√≥ximos</small>\n      ${currentMapaInfo.coordenadas?`<br><small>üìä √Årea de busca: ${currentMapaInfo.coordenadas}</small>`:""}\n    `),e.innerHTML="",currentLocais.length?currentLocais.forEach(((n,t)=>{const o=document.createElement("div");o.className="card",o.style.position="relative";const a="shopping"===n.tipo?"üè¨":"üè™",r=n.rating?`‚≠ê ${n.rating}`:"",i=n.endereco||n.address||"Endere√ßo n√£o dispon√≠vel";o.innerHTML=`\n      <div style="padding: 1rem;">\n        <h3 style="margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.5rem;">\n          ${a} ${n.nome||n.name||"Estabelecimento"}\n        </h3>\n        <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">\n          üìç ${i}\n        </p>\n        ${r?`<p style="margin: 0.25rem 0; color: #f59e0b; font-size: 0.9rem;">${r}</p>`:""}\n        ${n.telefone?`<p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üìû ${n.telefone}</p>`:""}\n        ${n.horarios?`<p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">üïí ${n.horarios}</p>`:""}\n        <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">\n          ${n.website?`<a href="${n.website}" target="_blank" rel="noopener noreferrer" style="flex: 1; min-width: 100px; text-align: center; padding: 0.5rem; background: var(--primary-color); color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;">üåê Site</a>`:""}\n          ${n.maps_url?`<a href="${n.maps_url}" target="_blank" rel="noopener noreferrer" style="flex: 1; min-width: 100px; text-align: center; padding: 0.5rem; background: #10b981; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;">üó∫Ô∏è Mapa</a>`:""}\n        </div>\n      </div>\n    `,o.addEventListener("click",(()=>{window.analyticsService&&window.analyticsService.trackEvent("location_view","user_interaction",n.nome||n.name,{tipo:n.tipo,rating:n.rating,position:t})})),e.appendChild(o)})):e.innerHTML='\n      <div style="grid-column:1/-1;text-align:center;color:#888;padding:2rem;">\n        <p>üè™ Nenhuma loja encontrada na regi√£o</p>\n        <small>Tente uma cidade diferente ou verifique a conectividade</small>\n      </div>\n    '}function configurarNavegacaoAbas(){const e=document.getElementById("btnVerResultados"),n=document.getElementById("btnVerFavoritos"),t=document.getElementById("btnVerLocais"),o=document.getElementById("produtos"),a=document.getElementById("favoritos"),r=document.getElementById("locais");function i(){o.style.display="none",a.style.display="none",r.style.display="none"}function s(){[e,n,t].forEach((e=>{e.classList.remove("active")}))}e.onclick=()=>{i(),s(),o.style.display="",e.classList.add("active"),window.analyticsService&&window.analyticsService.trackEvent("tab_switch","navigation","resultados")},n.onclick=()=>{i(),s(),a.style.display="",n.classList.add("active"),renderFavoritos(),window.analyticsService&&window.analyticsService.trackEvent("tab_switch","navigation","favoritos")},t.onclick=()=>{i(),s(),r.style.display="",t.classList.add("active"),currentLocais.length||(document.getElementById("mapaInfo").innerHTML="\n        <strong>üìç Busca de Lojas Pr√≥ximas</strong><br>\n        <small>Use a busca IA (ü§ñ IA) para encontrar lojas pr√≥ximas baseado nos seus crit√©rios</small>\n      "),window.analyticsService&&window.analyticsService.trackEvent("tab_switch","navigation","locais")}}function initializeDarkMode(){const e=document.getElementById("toggleDark");if(!e)return;const n=localStorage.getItem("theme")||"light";"dark"===n?document.body.classList.add("dark"):document.body.classList.remove("dark"),updateDarkModeButton(n),e.addEventListener("click",(()=>{const e=document.body.classList.contains("dark")?"light":"dark";"dark"===e?document.body.classList.add("dark"):document.body.classList.remove("dark"),localStorage.setItem("theme",e),updateDarkModeButton(e),window.analyticsService&&window.analyticsService.trackEvent("UI_Interaction","dark_mode_toggle",e)}))}function updateDarkModeButton(e){const n=document.getElementById("toggleDark");if(!n)return;const t=n.querySelector(".dark-icon"),o=n.querySelector(".light-icon");"dark"===e?(t&&(t.style.display="none"),o&&(o.style.display="inline"),n.setAttribute("aria-label","Alternar para modo claro"),n.setAttribute("title","Alternar para modo claro")):(t&&(t.style.display="inline"),o&&(o.style.display="none"),n.setAttribute("aria-label","Alternar para modo escuro"),n.setAttribute("title","Alternar para modo escuro"))}function initializeLanguageSwitcher(){const e=document.getElementById("btnLang");if(!e)return;updateLanguage(localStorage.getItem("language")||"pt"),e.addEventListener("click",(()=>{const e="pt"===(localStorage.getItem("language")||"pt")?"en":"pt";updateLanguage(e),window.analyticsService&&window.analyticsService.trackEvent("UI_Interaction","language_switch",e)}))}function updateLanguage(e){const n=document.getElementById("btnLang");n&&(localStorage.setItem("language",e),"en"===e?(n.textContent="üáßüá∑",n.setAttribute("title","Switch to Portuguese"),document.documentElement.lang="en"):(n.textContent="üá∫üá∏",n.setAttribute("title","Switch to English"),document.documentElement.lang="pt-BR"),"function"==typeof updateInterfaceLanguage&&updateInterfaceLanguage(e),updateFormLanguage(e))}function updateFormLanguage(e){const n={pt:{precoMax:"Pre√ßo m√°ximo",idade:"Idade",genero:"G√™nero",buscar:"BUSCAR",ia:"ü§ñ IA",masculino:"Masculino",feminino:"Feminino",unisex:"Unissex"},en:{precoMax:"Max price",idade:"Age",genero:"Gender",buscar:"SEARCH",ia:"ü§ñ AI",masculino:"Male",feminino:"Female",unisex:"Unisex"}},t=n[e]||n.pt,o=document.getElementById("precoMax");o&&(o.placeholder=t.precoMax);const a=document.getElementById("idadeInput");a&&(a.placeholder=t.idade);const r=document.getElementById("generoSelect");r&&(r.options[0].textContent=t.genero,r.options[1].textContent=t.masculino,r.options[2].textContent=t.feminino,r.options[3].textContent=t.unisex);const i=document.querySelector('button[type="submit"]');i&&(i.textContent=t.buscar);const s=document.getElementById("btnAIPowered");s&&(s.textContent=t.ia);const c=document.getElementById("btnVerResultados");c&&(c.textContent="en"===e?"Results":"Resultados");const d=document.getElementById("btnVerFavoritos");d&&(d.textContent="en"===e?"Favorites":"Favoritos");const l=document.getElementById("btnVerLocais");l&&(l.textContent="en"===e?"Nearby Stores":"Lojas Pr√≥ximas")}function initializeSearchFunctionality(){const e=document.getElementById("searchForm");e&&e.addEventListener("submit",(e=>{e.preventDefault();const n=document.getElementById("precoMax")?.value||"",t=document.getElementById("idadeInput")?.value||"",o=document.getElementById("generoSelect")?.value||"";if(t&&(parseInt(t)<0||parseInt(t)>120))return void showMensagem("Por favor, insira uma idade entre 0 e 120 anos.",!0);if(!n&&!t&&!o)return void showMensagem("Preencha pelo menos um filtro.",!0);const a={};n&&(a.precoMax=n),t&&(a.idade=t),o&&(a.genero=o),buscarProdutos(a).then((e=>{e&&e.produtos?(renderGrid(e.produtos),renderPaginacao(e.pagina||1,e.totalPaginas||1),mostrarSecao("produtos"),0===e.produtos.length&&showMensagem("Nenhum produto encontrado. Tente ajustar os filtros.")):showMensagem("Erro na busca. Tente novamente.",!0)})).catch((e=>{console.error("Erro na busca:",e),showMensagem("Erro na busca. Tente novamente.",!0)}))}))}document.addEventListener("DOMContentLoaded",(()=>{initializeDarkMode(),initializeLanguageSwitcher(),initializeSearchFunctionality()})),document.addEventListener("DOMContentLoaded",(()=>{configurarNavegacaoAbas();const e=document.getElementById("searchForm");e.onsubmit;e.onsubmit=async e=>{e.preventDefault();const n={precoMax:document.getElementById("precoMax").value,idade:document.getElementById("idadeInput").value,genero:document.getElementById("generoSelect").value,page:1};document.getElementById("produtos").style.display="",await carregarProdutos(n)}})),window.buscarLojasProximas=buscarLojasProximas,window.buscarShoppings=buscarShoppings,window.mostrarPoliticaPrivacidade=function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 10000;\n    padding: 1rem;\n  ";const n=document.createElement("div");n.style.cssText="\n    background: white;\n    border-radius: 16px;\n    padding: 2rem;\n    max-width: 600px;\n    max-height: 80vh;\n    overflow-y: auto;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n    position: relative;\n  ",n.innerHTML='\n    <button onclick="this.closest(\'.modal\').remove()" style="\n      position: absolute;\n      top: 1rem;\n      right: 1rem;\n      background: #f1f5f9;\n      border: none;\n      border-radius: 50%;\n      width: 32px;\n      height: 32px;\n      cursor: pointer;\n      font-size: 18px;\n    ">√ó</button>\n    <h2 style="color: #4e54c8; margin-bottom: 1.5rem;">Pol√≠tica de Privacidade</h2>\n    <div style="color: #475569; line-height: 1.6;">\n      <h3>1. Coleta de Informa√ß√µes</h3>\n      <p>O Easy Gift Search coleta apenas informa√ß√µes necess√°rias para melhorar sua experi√™ncia de busca de presentes.</p>\n      \n      <h3>2. Uso das Informa√ß√µes</h3>\n      <p>Utilizamos suas informa√ß√µes para personalizar recomenda√ß√µes e melhorar nossos servi√ßos.</p>\n      \n      <h3>3. Compartilhamento</h3>\n      <p>N√£o compartilhamos suas informa√ß√µes pessoais com terceiros sem seu consentimento.</p>\n      \n      <h3>4. Cookies</h3>\n      <p>Utilizamos cookies para melhorar a funcionalidade do site e personalizar sua experi√™ncia.</p>\n      \n      <h3>5. Seguran√ßa</h3>\n      <p>Implementamos medidas de seguran√ßa para proteger suas informa√ß√µes.</p>\n      \n      <h3>6. Contato</h3>\n      <p>Para d√∫vidas sobre privacidade, entre em contato: <strong>contato@easygift.com</strong></p>\n      \n      <p style="margin-top: 1.5rem; font-size: 0.9rem; color: #64748b;">\n        <strong>√öltima atualiza√ß√£o:</strong> Janeiro 2025\n      </p>\n    </div>\n  ',e.className="modal",e.appendChild(n),document.body.appendChild(e),e.addEventListener("click",(n=>{n.target===e&&e.remove()}))},window.mostrarTermosUso=function(){const e=document.createElement("div");e.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 10000;\n    padding: 1rem;\n  ";const n=document.createElement("div");n.style.cssText="\n    background: white;\n    border-radius: 16px;\n    padding: 2rem;\n    max-width: 600px;\n    max-height: 80vh;\n    overflow-y: auto;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n    position: relative;\n  ",n.innerHTML='\n    <button onclick="this.closest(\'.modal\').remove()" style="\n      position: absolute;\n      top: 1rem;\n      right: 1rem;\n      background: #f1f5f9;\n      border: none;\n      border-radius: 50%;\n      width: 32px;\n      height: 32px;\n      cursor: pointer;\n      font-size: 18px;\n    ">√ó</button>\n    <h2 style="color: #4e54c8; margin-bottom: 1.5rem;">Termos de Uso</h2>\n    <div style="color: #475569; line-height: 1.6;">\n      <h3>1. Aceita√ß√£o dos Termos</h3>\n      <p>Ao usar o Easy Gift Search, voc√™ concorda com estes termos de uso.</p>\n      \n      <h3>2. Servi√ßos Oferecidos</h3>\n      <p>Oferecemos um servi√ßo de busca e recomenda√ß√£o de presentes usando intelig√™ncia artificial.</p>\n      \n      <h3>3. Uso Respons√°vel</h3>\n      <p>Voc√™ concorda em usar o servi√ßo de forma legal e respons√°vel.</p>\n      \n      <h3>4. Limita√ß√£o de Responsabilidade</h3>\n      <p>O Easy Gift Search n√£o se responsabiliza por transa√ß√µes realizadas em sites externos.</p>\n      \n      <h3>5. Propriedade Intelectual</h3>\n      <p>Todo o conte√∫do do site √© protegido por direitos autorais.</p>\n      \n      <h3>6. Modifica√ß√µes</h3>\n      <p>Reservamos o direito de modificar estes termos a qualquer momento.</p>\n      \n      <h3>7. Contato</h3>\n      <p>Para quest√µes legais, entre em contato: <strong>contato@easygift.com</strong></p>\n      \n      <p style="margin-top: 1.5rem; font-size: 0.9rem; color: #64748b;">\n        <strong>√öltima atualiza√ß√£o:</strong> Janeiro 2025\n      </p>\n    </div>\n  ',e.className="modal",e.appendChild(n),document.body.appendChild(e),e.addEventListener("click",(n=>{n.target===e&&e.remove()}))};